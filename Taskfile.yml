version: '3'

tasks:
  default:
    cmds:
      - task: serve

  init:
    cmds:
      - git init
      - uv init .
      - uv add --dev ruff
      - uv add pyyaml pydantic requests
      - git add .
      - git commit -m "init"

  fmt:
    cmds:
      - uv run ruff format .

  lint:
    cmds:
      - uv run ruff check . --fix

  scripts:links:
    cmds:
      - uv run scripts/maintain.py add-links

  scripts:check:
    cmds:
      - uv run scripts/maintain.py check-links

  scripts:cards:
    cmds:
      - uv run scripts/maintain.py sync-cards

  scripts:assets:
    cmds:
      - uv run scripts/maintain.py download-assets

  serve:
    cmds:
      - uv run mkdocs serve -a localhost:8080

  build:
    cmds:
      - uv run mkdocs build

  deploy:
    cmds:
      - uv run mkdocs gh-deploy --force

  agent:review:
    desc: "AI: 3ãƒšãƒ«ã‚½ãƒŠã«ã‚ˆã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ¬ãƒ“ãƒ¥ãƒ¼"
    cmds:
      - echo "ğŸ” Agent /review triggered. Use chat command '/review' or pass file path."
      - echo "Target:{{.CLI_ARGS | default \"docs/megami/*.md\"}}"

  agent:audit:
    desc: "AI: å…¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ¨ªæ–­ã®ä¸€è²«æ€§ç›£æŸ»"
    cmds:
      - echo "ğŸ” Agent /audit triggered."
      - uv run scripts/maintain.py check-links
      - uv run scripts/maintain.py add-links

  agent:seo:
    desc: "AI: æ§‹é€ ãƒ»SEOãƒ»ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æœ€é©åŒ–"
    cmds:
      - echo "ğŸ” Agent /seo triggered."
      - find docs/ -name "*.md" -type f | sort

  agent:deepen:
    desc: "AI: æˆ¦ç•¥è¨˜è¿°ã®æ·±åŒ–ãƒ»æ¤œè¨¼"
    cmds:
      - echo "ğŸ” Agent /deepen triggered. Use chat command '/deepen' or pass megami name."
      - echo "Target:{{.CLI_ARGS | default \"docs/megami/*.md\"}}"

  agent:maintain:
    desc: "AI: ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚¿ã‚¹ã‚¯ä¸€æ‹¬å®Ÿè¡Œ"
    cmds:
      - uv run scripts/maintain.py check-links
      - uv run scripts/maintain.py add-links
      - uv run scripts/maintain.py download-assets
      - uv run mkdocs build --strict

  agent:all:
    desc: "AI: å…¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä¸€æ‹¬å®Ÿè¡Œ"
    cmds:
      - task: agent:maintain
      - task: agent:audit
      - task: agent:seo
      - task: agent:review
      - task: agent:deepen
