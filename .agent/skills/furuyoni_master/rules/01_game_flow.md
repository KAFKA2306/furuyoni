# 決闘の完全なフロー

このドキュメントは「桜降る代に決闘を」の決闘進行を**厳密な解決順序**で記述する。
agentはこの順序を正確に理解した上でレビュー・編集を行うこと。

---

## 1. 決闘準備

### 1-1. 三拾一捨（さんじゅういっしゃ）
- 各プレイヤーは**3柱**のメガミを提示する。
- 相手が提示した3柱のうち**1柱を除外（BAN）**する。
- 残った**2柱**で決闘を行う。

### 1-2. 眼前構築（がんぜんこうちく）
- 選ばれた2柱のカードプール（各メガミ通常札7枚 + 切札4枚 = 合計**22枚**の使用可能カード）から以下を選択する：
  - **通常札7枚を選択**（2柱合計14枚の通常札から7枚を選ぶ）→ 山札になる
  - **切札3枚を選択**（2柱合計8枚の切札から3枚を選ぶ）→ 表にして手元に置く
- 選ばなかったカードは決闘中使用しない。

### 1-3. 初期配置
- **間合**: 10
- **各プレイヤーのオーラ**: 3
- **各プレイヤーのライフ**: 10
- **ダスト**: 0（オーラに配置されなかった分は間合に追加されるが、基本ルールでは初期間合10）
- **各プレイヤーの集中力**: 0
- **各プレイヤーのフレア**: 0
- 通常札7枚をシャッフルして山札に → 最初の手札は3枚ドロー。

---

## 2. ターン構造

各ターンは以下の3フェイズで構成される。ターンプレイヤー（先攻/後攻が交互）が処理する。

> **重要**: 先攻の最初のターン・後攻の最初のターンは**開始フェイズを行わない**（ドローも集中力増加もない）。

### 2-1. 開始フェイズ

以下の4ステップを**この順序で**処理する。順序を間違えると裁定が狂う。

#### Step 1: 集中力の増加
- 自分の集中力を**+1**する。
- **上限**: 集中力は最大**2**まで。既に2なら増加しない。
- **萎縮状態の場合**: 集中力は増加しない（萎縮はここで消費される）。

#### Step 2: 付与札の結晶減少
- **自分と相手の両方**の展開中の付与札から、桜花結晶を**1つずつダスト**へ移す。
- 結晶が**0になった付与札は捨て札**になる（このとき「破棄時」効果が発動する）。
- 付与札の破棄は同時ではなく、ターンプレイヤーの付与から先に処理する。

#### Step 3: 再構成（任意 or 強制）
- **任意再構成**: 自分の捨て札・伏せ札・山札をすべて混ぜてシャッフルし、新たな山札とする。
  - **コスト**: ライフに**1ダメージ**（ライフから1つダストへ）。
  - 展開中の付与札はそのまま残る。
- **強制再構成**: 山札が0枚の場合、再構成は**強制**（拒否不可）。

#### Step 4: ドロー
- 山札から**2枚**引く。
- **山札不足の場合（焦燥）**:
  - 引けなかった枚数分、**焦燥ダメージ**を受ける。
  - 焦燥ダメージ = 1枚あたり**オーラ or ライフに1ダメージ**（受け手が選択）。
  - 焦燥ダメージは攻撃ではないため、対応不可。

### 2-2. メインフェイズ

以下の**どちらか一方**を選択する（混在不可）：

#### A. 標準行動
以下を**任意の回数・任意の順序**で繰り返せる：
- **カード使用**: 手札から通常札を使用 or 未使用の切札を使用
  - ただし**全力サブタイプ**のカードは標準行動中に使用不可
- **基本動作**: 集中力1 or 手札1枚を伏せてコストを支払い、基本動作を行う
  - 前進 / 後退 / 纏い / 宿し（詳細は `02_crystal_movement.md`）

#### B. 全力行動
- **全力サブタイプ**のカードを1枚使用する。
- 全力行動を選んだ場合、そのターンは**他のカード使用・基本動作は一切不可**。
- 全力カードの使用前に標準行動を行っていた場合、全力カードは使用できない。

### 2-3. 終了フェイズ
- **手札上限チェック**: 手札が上限（通常2枚）を超えている場合、超過分を伏せ札にする。
- ターンプレイヤーが交代する。

---

## 3. 勝利条件

- 相手の**ライフが0**になった時点で勝利。
- 特殊勝利条件を持つカード（カナヱの構想など）が条件を満たした場合。

---

## 4. ゲーム中の重要な原則

### 結晶の保存則
- 桜花結晶は（極めて稀な例外を除き）ゲームから消滅しない。
- 常にいずれかのエリア（間合・オーラ・ライフ・フレア・ダスト・付与札上・造花結晶）に存在する。

### 「できない」の処理
- 何かを移動する効果において、移動元に結晶がない場合は「できない」として無視される。
- オーラ上限5を超える結晶の移動はできない。

### 同時処理の原則
- 複数の効果が同時に発生する場合、ターンプレイヤーが処理順を決定する。
